# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Repository Overview

Terraform module for provisioning MongoDB clusters on Yandex Cloud. Creates a managed MongoDB cluster with configurable hosts (MONGOD, MONGOS, MONGOCFG, MONGOINFRA), databases, and users.

## Development Commands

```bash
# Format and validate
terraform fmt --recursive
terraform validate

# Run all pre-commit hooks
pre-commit run --all-files

# Individual linters (as run in CI)
tflint --init && tflint -f compact
tfsec
checkov -f terraform --framework terraform
```

## Testing with Examples

```bash
cd examples/complete/  # or examples/minimal/
export YC_FOLDER_ID='your-folder-id'
terraform init
terraform plan
terraform apply
terraform destroy
```

## Architecture

Three Yandex Cloud resources created in `main.tf`:
1. `yandex_mdb_mongodb_cluster` - Main cluster with all configuration
2. `yandex_mdb_mongodb_database` - Database within the cluster
3. `yandex_mdb_mongodb_user` - User with permissions (depends on database)

Dynamic blocks handle optional features: backup_window_start, performance_diagnostics, access, disk_size_autoscaling (4 host types), maintenance_window, restore, timeouts, and resource specs for mongos/mongocfg/mongoinfra.

## CI/CD Pipeline

GitHub Actions workflow (`.github/workflows/pipeline.yml`):
- **Linters job**: terraform fmt, TFLint, TFSec, Checkov (all soft-fail)
- **Semver job**: Auto-versioning with git-flow-action, creates GitHub releases on main

## Code Standards

- README.md is auto-generated by terraform-docs (edit between `<!-- BEGIN_TF_DOCS -->` markers only)
- Pre-commit hooks enforce: formatting, validation, docs generation, linting
- Variables use validation blocks for input constraints (see `variables.tf`)
- MongoDB versions supported: 7.0, 8.0
